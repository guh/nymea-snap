name: nymea
version: 0.12.0
summary: An open source IoT server
description: | 
  The nymea daemon is a plugin based IoT (Internet of Things) server. 
  The server works like a translator for devices, things and services 
  and allows them to interact. With the powerful rule engine you are 
  able to connect any device available in the system and create individual 
  scenes and behaviors for your environment.

grade: stable
confinement: strict

apps:
  nymead:
    command: env PATH=$PATH:$SNAP/bin nymead-wrapper.sh
    daemon: simple
    restart-condition: always
    slots: [ nymead-dbus ]
    plugs:
      - avahi-control
      - avahi-observe
      - bluez
      - device-buttons
      - network
      - network-bind
      - network-observe
      - network-manager
      - network-setup-control
      - hardware-observe
      - shutdown
      - system-files   
      - snapd-control #For the snap plugin

  nymea-cli:
    command: env PATH=$PATH:$SNAP/bin qt5-launch nymea-cli
    plugs:
      - network
      - network-bind

slots:
  # Note: this slot opens the D-Bus interface of nymea from in the snap environment
  nymead-dbus:
    interface: dbus
    name: io.guh.nymead
    bus: system

parts:
  # Custom launcher to support also armhf
  scripts:
    plugin: dump
    source: .
    build-attributes: [keep-execstack]
    organize:
      qt5-launch: bin/
      nymead-wrapper.sh: bin/
      nymead.conf: template-nymead.conf
      logging.conf: default-logging.conf

  # Adding the whole nymea project containig libnymea and nymea-plugins
  nymea:
    plugin: nil
    build-attributes: [keep-execstack]
    stage-packages:
      - nymea
      - nymea-cli
      - nymea-plugins
      - nymea-plugins-maker
      - nymea-plugin-snapd
